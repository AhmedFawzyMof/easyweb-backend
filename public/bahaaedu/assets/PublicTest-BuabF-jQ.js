import{_ as g,B as f,Q as x,u as y,a as n,r as l,o as u,c as w,d as _,w as v,e as T,b as r,j as P,t as d,n as k,i as h,v as p}from"./index-ClkC-KWi.js";import{Q as D,s as C}from"./shuffleArray-qmA_B5Fe.js";const S={name:"PublicTest",components:{Question:D,FwbButton:f,FwbModal:x},data(){return{publicTest:[],question:{},currentPage:1,totalPages:1,toast:y(),isShowModal:!1,userData:{name:"",phone:""}}},mounted(){this.getUserData(),this.getPublicTest(),this.$store.dispatch("clearAnswers")},methods:{getUserData(){const e=JSON.parse(localStorage.getItem("public-user-data"));if(!e){this.ToggleModal(!0);return}this.userData=e},CheckUserTokeThisTest(e){e.preventDefault(),localStorage.setItem("public-user-data",JSON.stringify(this.userData)),n.post(`/public_tests/${this.$route.params.id}/user`,this.userData).then(t=>{t.data.message==="لا يوجد مستخدم بهذه البيانات"?this.ToggleModal(!1):(this.ToggleModal(!0),this.toast.error("لقد قام هذا المستخدم بهذا الاختبار"))})},getPublicTest(){n.get(`/public_tests/${this.$route.params.id}`,{headers:{Authorization:`Bearer ${this.$store.state.token}`}}).then(e=>{const t=e.data.map(i=>(Object.keys(i).forEach(s=>{i[s]===null&&delete i[s]}),i));this.publicTest=C(t),this.totalPages=this.publicTest.length,this.question=this.publicTest[0]}).catch(e=>{e.response&&e.response.status===401&&(this.toast.error("خطأ: غير مصرح به"),this.$store.commit("logout"),this.$router.push("/bahaaedu/login")),e.response.status===500&&(this.toast.error(e.response.data.error),this.$router.push("/bahaaedu/dashboard"))})},ToggleModal(e){this.isShowModal=e},ChangeQuestion(e){this.currentPage=e,this.question=this.publicTest[this.currentPage-1]},submitAnswers(){this.canSubmit&&n.post(`/public_tests/${this.$route.params.id}`,{answers:this.$store.state.answers,student_name:this.userData.name,student_phone:this.userData.phone},{headers:{Authorization:`Bearer ${this.$store.state.token}`,"Content-Type":"application/json"}}).then(e=>{const t=e.data.message;this.toast.success(t),this.$router.push("/bahaaedu/dashboard")}).catch(e=>{e.response&&e.response.status===401?(this.toast.error("خطأ: غير مصرح به"),this.$store.commit("logout"),this.$router.push("/bahaaedu/login")):this.toast.error(e.response.error)})}},computed:{canSubmit(){return this.totalPages===this.$store.state.answers.length}},watch:{currentPage(e){this.ChangeQuestion(e)}}},Q={class:"w-full flex justify-center items-center flex-col gap-10"},M={class:"flex flex-col gap-4"},A={class:"flex flex-col gap-2"},B={class:"flex flex-col gap-2"},j={class:"questions w-full px-4 flex flex-col gap-4 items-center justify-center max-w-3xl"},U={class:"buttons flex flex-col gap-4 mt-10 w-full justify-center items-center"},N={class:"flex gap-4"},V=["disabled"],q={class:"current-page p-2 rounded-md bg-primary text-white"},z=["disabled"],$=["disabled"];function O(e,t,i,c,s,a){const m=l("fwb-modal"),b=l("Question");return u(),w("div",Q,[s.isShowModal?(u(),_(m,{key:0,persistent:"",size:"md"},{body:v(()=>[r("div",M,[r("form",{onSubmit:t[2]||(t[2]=o=>a.CheckUserTokeThisTest(o))},[r("div",A,[t[6]||(t[6]=r("label",{for:"name",class:"text-lg font-bold text-primary"},"اسم المستخدم",-1)),h(r("input",{type:"text",id:"name","onUpdate:modelValue":t[0]||(t[0]=o=>s.userData.name=o),class:"border border-primary rounded-md p-2"},null,512),[[p,s.userData.name]])]),r("div",B,[t[7]||(t[7]=r("label",{for:"phone",class:"text-lg font-bold text-primary"},"رقم الجوال",-1)),h(r("input",{type:"text",id:"phone","onUpdate:modelValue":t[1]||(t[1]=o=>s.userData.phone=o),class:"border border-primary rounded-md p-2"},null,512),[[p,s.userData.phone]])]),t[8]||(t[8]=r("button",{class:"bg-primary text-white mt-5 p-2 rounded-md",type:"submit"}," حفظ البيانات ",-1))],32)])]),_:1})):T("",!0),r("div",j,[P(b,{question:s.question,index:s.currentPage},null,8,["question","index"])]),r("div",U,[r("div",N,[r("button",{class:"btn btn-primary border border-primary rounded-md p-2 hover:bg-primary hover:text-white duration-300 disabled:cursor-not-allowed disabled:opacity-50",onClick:t[3]||(t[3]=o=>a.ChangeQuestion(s.currentPage+1)),disabled:s.currentPage===s.totalPages}," التالي ",8,V),r("div",q,d(s.currentPage)+" / "+d(s.totalPages),1),r("button",{class:"btn btn-primary border border-primary rounded-md p-2 hover:bg-primary hover:text-white duration-300 disabled:cursor-not-allowed disabled:opacity-50",onClick:t[4]||(t[4]=o=>a.ChangeQuestion(s.currentPage-1)),disabled:s.currentPage===1}," السابق ",8,z)]),r("button",{onClick:t[5]||(t[5]=(...o)=>a.submitAnswers&&a.submitAnswers(...o)),class:k(["btn btn-primary border bg-primary text-white rounded-md p-2 hover:bg-white hover:text-primary hover:border-primary duration-300 w-48",{"opacity-50 cursor-not-allowed":!a.canSubmit}]),disabled:!a.canSubmit}," إرسال الاجابات ",10,$)])])}const I=g(S,[["render",O]]);export{I as default};
