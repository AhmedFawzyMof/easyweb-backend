import{_ as c,u as h,a as u,r as d,o as g,c as p,b as r,t as n,j as b,n as f}from"./index-ClkC-KWi.js";import{Q as y,s as x}from"./shuffleArray-qmA_B5Fe.js";const _={name:"TestsQuestions",components:{Question:y},data(){return{test:[],question:{},currentPage:1,totalPages:1,remainingTime:JSON.parse(localStorage.getItem("remainingTime"))||30*60,timer:null,toast:h()}},mounted(){this.getTest(),this.$store.dispatch("clearAnswers"),this.startTimer()},methods:{getTest(){u.get(`/tests/${this.$route.params.id}`,{headers:{Authorization:`Bearer ${this.$store.state.token}`}}).then(e=>{const s=e.data.map(o=>(Object.keys(o).forEach(t=>{o[t]===null&&delete o[t]}),o));this.test=x(s),this.totalPages=this.test.length,this.question=this.test[0]}).catch(e=>{e.response&&e.response.status===401&&(this.toast.error("خطأ: غير مصرح به"),this.$store.commit("logout"),this.$router.push("/bahaaedu/login"))})},ChangeQuestion(e){this.currentPage=e,this.question=this.test[this.currentPage-1]},startTimer(){this.timer=setInterval(()=>{this.remainingTime>0?(this.remainingTime--,localStorage.setItem("remainingTime",this.remainingTime)):(localStorage.removeItem("remainingTime"),this.submitAnswers())},1e3)},submitAnswers(){this.canSubmit&&u.post(`/tests/${this.$route.params.id}`,this.$store.state.answers,{headers:{Authorization:`Bearer ${this.$store.state.token}`,"Content-Type":"application/json"}}).then(e=>{const s=e.data.message;clearInterval(this.timer),this.toast.success(s),this.$router.push("/bahaaedu/dashboard")}).catch(e=>{e.response&&e.response.status===401?(this.toast.error("خطأ: غير مصرح به"),this.$store.commit("logout"),this.$router.push("/bahaaedu/login")):this.toast.error(e.response.error)})},formatTimer(){return parseInt(this.remainingTime/60)}},computed:{canSubmit(){return this.totalPages===this.$store.state.answers.length}},watch:{currentPage(e){this.ChangeQuestion(e)}},beforeUnmount(){clearInterval(this.timer)}},w={class:"w-full flex justify-center items-center flex-col gap-10"},v={class:"questions w-full px-4 flex flex-col gap-4 items-center justify-center max-w-3xl"},T={class:"text-lg font-bold text-primary"},P={class:"buttons flex flex-col gap-4 mt-10 w-full justify-center items-center"},C={class:"flex gap-4"},Q=["disabled"],k={class:"current-page p-2 rounded-md bg-primary text-white"},A=["disabled"],S=["disabled"];function I(e,s,o,l,t,i){const m=d("Question");return g(),p("div",w,[r("div",v,[r("p",T," الوقت المتبقي : "+n(i.formatTimer())+" دقائق ",1),b(m,{question:t.question,index:t.currentPage},null,8,["question","index"])]),r("div",P,[r("div",C,[r("button",{class:"btn btn-primary border border-primary rounded-md p-2 hover:bg-primary hover:text-white duration-300 disabled:cursor-not-allowed disabled:opacity-50",onClick:s[0]||(s[0]=a=>i.ChangeQuestion(t.currentPage+1)),disabled:t.currentPage===t.totalPages}," التالي ",8,Q),r("div",k,n(t.currentPage)+" / "+n(t.totalPages),1),r("button",{class:"btn btn-primary border border-primary rounded-md p-2 hover:bg-primary hover:text-white duration-300 disabled:cursor-not-allowed disabled:opacity-50",onClick:s[1]||(s[1]=a=>i.ChangeQuestion(t.currentPage-1)),disabled:t.currentPage===1}," السابق ",8,A)]),r("button",{onClick:s[2]||(s[2]=(...a)=>i.submitAnswers&&i.submitAnswers(...a)),class:f(["btn btn-primary border bg-primary text-white rounded-md p-2 hover:bg-white hover:text-primary hover:border-primary duration-300 w-48",{"opacity-50 cursor-not-allowed":!i.canSubmit}]),disabled:!i.canSubmit}," إرسال الاجابات ",10,S)])])}const B=c(_,[["render",I]]);export{B as default};
